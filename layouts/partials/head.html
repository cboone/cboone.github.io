<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="color-scheme" content="light dark">
{{- if hugo.IsProduction | and (ne .Params.robotsNoIndex true) }}
<meta name="robots" content="index, follow">
{{- else }}
<meta name="robots" content="noindex, nofollow">
{{- end }}

{{- /* Title */}}
<title>
  {{- if eq .Kind "404" -}}
    404: Page not found | {{ .Site.Title }}
  {{- else if and (not .IsHome) .Title -}}
    {{ .Title }} | {{ .Site.Title }}
  {{- else -}}
    {{ .Site.Title }}
  {{- end -}}
</title>

{{- /* Meta */}}
{{- if .IsHome }}
{{ with site.Params.keywords -}}<meta name="keywords" content="{{- range $i, $e := . }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}">{{ end }}
{{- else }}
<meta name="keywords" content="{{ if .Params.keywords -}}
    {{- range $i, $e := .Params.keywords }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} {{- else }}
    {{- range $i, $e := .Params.tags }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} {{- end -}}">
{{- end }}
<meta name="description" content="{{- with .Description }}{{ . }}{{- else }}{{- if or .IsPage .IsSection}}
    {{- .Summary | default (printf "%s - %s" .Title  site.Title) }}{{- else }}
    {{- with site.Params.description }}{{ . }}{{- end }}{{- end }}{{- end -}}">
<meta name="author" content="{{ (partial "author.html" . ) }}">
<link rel="canonical" href="{{ if .Params.canonicalURL -}} {{ trim .Params.canonicalURL " " }} {{- else -}} {{ .Permalink }} {{- end }}">

{{- /* Google Fonts */}}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=TASA+Explorer:wght@800&family=TASA+Orbiter:wght@400&display=swap" rel="stylesheet">

{{- /* Alpine.js */}}
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js" integrity="sha384-Bwp1iiDL2N8tn9t51Dj9IuyFx5LiPqfSc7B4l/PLSyB3mLeR1b/+yzSuBIqSfRzQ" crossorigin="anonymous"></script>

{{- /* Styles */}}

{{- /* Base styles */}}
{{- $variables := (resources.Get "css/base/variables.css") }}
{{- $reset := (resources.Get "css/base/reset.css") }}
{{- $typography := (resources.Get "css/base/typography.css") }}
{{- $scrollbar := (resources.Get "css/base/scrollbar.css") }}

{{- /* Components */}}
{{- $cards := (resources.Get "css/components/cards.css") }}
{{- $code := (resources.Get "css/components/code.css") }}
{{- $content := (resources.Get "css/components/content.css") }}
{{- $layout := (resources.Get "css/components/layout.css") }}
{{- $notice := (resources.Get "css/components/notice.css") }}
{{- $timeline := (resources.Get "css/components/timeline.css") }}

{{- /* Responsive (must be last) */}}
{{- $responsive := (resources.Get "css/base/responsive.css") }}

{{- /* Bundle: order is important */}}
{{- $stylesheet := (slice $variables $reset $typography $scrollbar $cards $code $content $layout $notice $timeline $responsive) | resources.Concat "assets/css/stylesheet.css" | resources.Minify }}

{{- if not site.Params.assets.disableFingerprinting }}
{{- $stylesheet := $stylesheet | fingerprint }}
<link crossorigin="anonymous" href="{{ $stylesheet.RelPermalink }}" integrity="{{ $stylesheet.Data.Integrity }}" rel="preload stylesheet" as="style">
{{- else }}
<link crossorigin="anonymous" href="{{ $stylesheet.RelPermalink }}" rel="preload stylesheet" as="style">
{{- end }}

{{- /* Search */}}
{{- if (eq .Layout `search`) -}}
<link crossorigin="anonymous" rel="preload" as="fetch" href="../index.json">
{{- $fastsearch := resources.Get "js/fastsearch.js" | js.Build (dict "params" (dict "fuseOpts" site.Params.fuseOpts)) | resources.Minify }}
{{- $fusejs := resources.Get "js/fuse.basic.min.js" }}
{{- $license_js := resources.Get "js/license.js" }}
{{- if not site.Params.assets.disableFingerprinting }}
{{- $search := (slice $fusejs $license_js $fastsearch ) | resources.Concat "assets/js/search.js" | fingerprint }}
<script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}" integrity="{{ $search.Data.Integrity }}"></script>
{{- else }}
{{- $search := (slice $fusejs $fastsearch ) | resources.Concat "assets/js/search.js" }}
<script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}"></script>
{{- end }}
{{- end -}}

{{- /* Favicons */}}
<link rel="icon" href="{{ site.Params.assets.favicon | default "favicon.ico" | absURL }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ site.Params.assets.favicon16x16 | default "favicon-16x16.png" | absURL }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ site.Params.assets.favicon32x32 | default "favicon-32x32.png" | absURL }}">
<link rel="apple-touch-icon" href="{{ site.Params.assets.apple_touch_icon | default "apple-touch-icon.png" | absURL }}">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="{{ site.Params.assets.theme_color_light | default "#ffffff" }}">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="{{ site.Params.assets.theme_color | default "#1d1e20" }}">
<meta name="msapplication-TileColor" content="{{ site.Params.assets.msapplication_TileColor | default "#2e2e33" }}">

{{- /* RSS */}}
{{ range .AlternativeOutputFormats -}}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type | html }}" href="{{ .Permalink | safeURL }}">
{{ end -}}
{{- range .AllTranslations -}}
<link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}">
{{ end -}}

{{- /* Alpine.js x-cloak support - hide elements until Alpine loads */}}
<style>[x-cloak] { display: none !important; }</style>

<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    {{- if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark")) }}
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --background-page: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--background-page);
            }

            .list::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list::-webkit-scrollbar-thumb {
                border-color: var(--background-page);
            }
        }

    </style>
    {{- end }}
</noscript>

{{- partial "templates/opengraph.html" . }}
{{- partial "templates/twitter_cards.html" . }}
{{- partial "templates/schema_json.html" . }}

{{ if and (hugo.IsProduction) (.Site.Params.googleAnalyticsID) }}
{{- partial "analytics.html" . }}
{{ end }}

{{ if or .Page.Params.math .Site.Params.math }}
{{- partial "math.html" .}}
{{ end }}

{{- /* Theme detection script - runs synchronously to prevent FOUC */}}
{{- if (not site.Params.disableThemeToggle) }}
{{- if (eq site.Params.defaultTheme "light") }}
<script>
    (function() {
        var theme = localStorage.getItem("pref-theme") === "dark" ? "dark" : "light";
        document.documentElement.dataset.theme = theme;
        window.__theme = theme;
    })();
</script>
{{- else if (eq site.Params.defaultTheme "dark") }}
<script>
    (function() {
        var theme = localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
        document.documentElement.dataset.theme = theme;
        window.__theme = theme;
    })();
</script>
{{- else }}
{{- /* theme is auto */}}
<script>
    (function() {
        var pref = localStorage.getItem("pref-theme");
        var theme;
        if (pref === "dark") {
            theme = "dark";
        } else if (pref === "light") {
            theme = "light";
        } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            theme = "dark";
        } else {
            theme = "light";
        }
        document.documentElement.dataset.theme = theme;
        window.__theme = theme;
    })();
</script>
{{- end }}
{{- else if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark"))}}
<script>
    (function() {
        var theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        document.documentElement.dataset.theme = theme;
        window.__theme = theme;
    })();
</script>
{{- end }}

{{- /* Alpine.js stores and global data */}}
<script>
    document.addEventListener('alpine:init', function() {
        Alpine.store('theme', {
            value: document.documentElement.dataset.theme || window.__theme || 'light',
            toggle: function() {
                this.value = this.value === 'dark' ? 'light' : 'dark';
                document.documentElement.dataset.theme = this.value;
                localStorage.setItem('pref-theme', this.value);
            }
        });

        Alpine.store('menu', {
            open: false,
            scrollPosition: Number(localStorage.getItem('menu-scroll-position')) || 0,
            toggle: function() {
                this.open = !this.open;
            },
            saveScrollPosition: function(position) {
                this.scrollPosition = position;
                localStorage.setItem('menu-scroll-position', position);
            }
        });

        Alpine.store('scrollToTop', {
            visible: false,
            update: function() {
                this.visible = document.body.scrollTop > 800 || document.documentElement.scrollTop > 800;
            }
        });
    });
</script>
